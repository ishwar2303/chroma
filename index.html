<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syntax Highlighting</title>
</head>
<body>
    <div class="wrapper">  

        <div chroma="true" language="javascript">
            
/* Import all supported languages */
import c_kit from './language/c'
import html_kit from './language/html'
import sql_kit from './language/sql'
import css_kit from './language/css'
import js_kit from './language/javascript'
/* Add all languages to array */

export const languages = Array()

export var supportedLangugaes = () => {
    languages.push(c_kit)
    languages.push(html_kit)
    languages.push(sql_kit)
    languages.push(css_kit)
    languages.push(js_kit)
    return languages
}

/* Pick language for processing regex */
/*
* @param Array
* @param string
*/
export const pickLanguage = (lang) => {
    let pick = false
    languages.forEach((s) => {
        if(s.lang == lang){
            pick = s
            return
        }
    })

    return pick
}

/*
* @param Array of object
* @param string
*/ 
export var matches = Array() // all matches with start and end position
export var beautify = '' // final beautiful version of code

// @param string
export const convertEntities = (code) => {
    return code.replace(/&lt;/g, '&lt;').replace(/>/g, '&gt;')
}

// @param string
export const resetEntities = (code) => {
    return code.replace(/&lt;/g, '&lt;').replace(/&gt;/g, '>').replace(/&amp;/g, '&')
}

// @param string
export const separatecodeLines = (code) => {
    return code.split("\n");
}

// @param int
export const prepareCodeLines = (len) => {
    let i, span
    let lineSet = document.createElement('div')
    lineSet.className = 'chroma-line-no'
    for(i=1; i&lt;=len; i++){
        span = document.createElement('span')
        span.innerHTML = i
        lineSet.appendChild(span)
    }
    return lineSet
}

/*
* @param int
* @param int
* */
export const overlapMatch = (start, end) => {
    return start >= end ? true : false
}

/*
* @param int
* @param int
* */
export const nullMatch = (start, end) => {
    return start != end ? true : false
}

/*
* @param string
*/
export const replaceMatch = (code) => {
    let endPos = 0

    matches.forEach((m) => {
        // console.log(m.start, m.end)
        if(overlapMatch(m.start, endPos) && !m.embedded){

            if(nullMatch(endPos, m.start))
                beautify += '&lt;span class="' + 'plain-text">' + code.substring(endPos, m.start)  + '&lt;/span>'

            beautify += '&lt;span class="' + m.class.replace(/\./g, ' ') + '">' + m.value + '&lt;/span>'
            endPos = m.end

        }
    })
    beautify += '&lt;span class="' + 'plain-text">' + code.substr(endPos, code.length) + '&lt;/span>'
}

// sorting matches in ascending order
// helps in finding matches overlaps
export const matchesSorting = (a, b) => {
    if(a.start &lt; b.start)
        return true
    else return false
}

/*
* @param string
* @param object
* @param int
*/
export const processPattern = (code, patt, offset) => {
    if(offset === void 0)
        offset = 0
    var pattern = new RegExp(patt.pattern)
    let match = pattern.exec(code)
    let startPos, endPos
    if(!match){ // no match found
        return false
    }

    startPos = match.index + offset
    endPos = startPos + match[0].length
    let embedded = ''
    if(patt.language)
        embedded = patt.language
    let obj = {
        value : match[0],
        start : startPos,
        end : endPos,
        class : patt.class,
        embedded
    }
    // if(embedded){
    //     let kit = pickLanguage(supportedLangugaes(), embedded)
    //     if(kit)
    //         processCodeWithPatterns(code.substring(startPos, endPos), kit.conversion, startPos)
    // }
    // console.log('HTML searching...')
    // console.log(code.substring(startPos, endPos))
    matches.push(obj)
    // console.log(patt)
    return {
        remaining : code.substring(endPos - offset),
        offset : endPos
    }


}
/*
* @param string
* @param array
*/
export const processCodeWithPatterns = (code, kit, offset) => {

    let pattern, i
    for(i=0; i&lt;kit.length; i++){
        let result = processPattern(code, kit[i], offset)
        while(result){
            result = processPattern(result.remaining, kit[i], result.offset)
        }
    }

}

export const embeddOtherLanguages = (code) => {

    matches.forEach((m) => {
        if(m.embedded){
            let kit = pickLanguage(m.embedded)
            if(kit){
                processCodeWithPatterns(code.substring(m.start, m.end), kit.conversion, m.start)
            }
        }
    })

}

/*
* @param dom html object
* @param string
* @param string
*/
const chromaCopy = (btn, copyCode, message) => {
    btn.disabled = true
    copyCode = copyCode.trim()
    let textarea = document.createElement('textarea')
    let body = document.body
    textarea.value = copyCode
    document.body.appendChild(textarea)
    textarea.select()
    document.execCommand('copy')
    body.removeChild(textarea)
    textarea.remove()
    let msg = document.createElement('div')
    if(copyCode != ''){
        msg.className = 'chroma-copy-msg'
        msg.innerHTML = message
    }
    else{
        msg.className = 'chroma-copy-msg'
        msg.innerHTML = 'Empty cannot be copied'
    }
    body.appendChild(msg)   
    setTimeout(() => {
        msg.remove()
        btn.disabled = false
    }, 2000)
}

/*
* preloader
*
*
*/
export const preloader = () => {
    let loader = document.createElement('div')
    loader.className = 'chroma-preloader'
    let main = document.createElement('div')
    main.innerHTML = '&lt;div>L&lt;/div>'
    main.innerHTML += '&lt;div>o&lt;/div>'
    main.innerHTML += '&lt;div>a&lt;/div>'
    main.innerHTML += '&lt;div>d&lt;/div>'
    main.innerHTML += '&lt;div>i&lt;/div>'
    main.innerHTML += '&lt;div>n&lt;/div>'
    main.innerHTML += '&lt;div>g&lt;/div>'
    loader.appendChild(main)

    return loader
}

/*
* Preparing front end output
* Set code copy button
* @param string
* @param dom object
* @param string
* @param string
* @param boolean
* @param boolean
*/ 
export const presentation = (code, lineset, linepad, header, headingValue, lang, copy, loaderValue) => {

    if(!headingValue)
        headingValue = lang.toUpperCase()
    let main = document.createElement('div')
    main.className = 'chroma'
    main.style.fontFamily = 'monospace'
    let chromaHeader, heading, btn
    if(header === 'true'){
        chromaHeader = document.createElement('div')
        chromaHeader.className = 'chroma-head chroma-sb'
        heading = document.createElement('div')
        heading.innerHTML = headingValue
        btn = document.createElement('button')
        if(copy === 'true'){
            heading.style.marginRight = '10px'
            btn.innerHTML = 'Copy'
            btn.className = 'chroma-copy'
            btn.style.display = 'none'
            btn.addEventListener('click', () => {
                chromaCopy(btn, resetEntities(code), 'Code copied successfully')
            })
        }
        chromaHeader.appendChild(heading)
        if(copy === 'true')
            chromaHeader.appendChild(btn)
    }
    let result = document.createElement('div')
    result.className = 'chroma-beautify'
    header ? result.className += ' chroma-no-header' : ''
    let sub = document.createElement('div')
    sub.className = 'chroma-flex-row'
    let pre = document.createElement('pre')
    pre.style.margin = 0
    pre.style.fontFamily = ''
    let codeBlock = document.createElement('code')
    codeBlock.innerHTML = beautify
    pre.appendChild(codeBlock)

    if(linepad === 'true')
        sub.appendChild(lineset)

    sub.appendChild(pre)
    result.appendChild(sub)
    if(header === 'true')
        main.appendChild(chromaHeader)
    main.appendChild(result)
    if(loaderValue === 'true'){
        // result.style.minHeight = ''
        sub.style.display = 'none'
        let loader = preloader()
        result.appendChild(loader)
        setTimeout(() => {
            loader.remove()
            result.style.minHeight = '0'
            sub.style.display = 'flex'
            if(copy === 'true' && header === 'true')
                btn.style.display = 'block'
        }, 1500)
    }
    return main

}

/*
* @param string
* @param object
* @param string heading=""
* @param string copy=""
* @param string preloader=""
* */
export const convert = (code, lang_kit, header, heading, copy, loader, linepad) => {
    matches = Array()
    beautify = ''

    code = convertEntities(code).trim()
    let codeLines = separatecodeLines(code)
    let totalLines = codeLines.length
    
    processCodeWithPatterns(code, lang_kit.conversion, 0)

    embeddOtherLanguages(code)

    matches.sort((a, b) => {return a.start - b.start})

    replaceMatch(code)

    let lineSet = prepareCodeLines(totalLines)
    let result = presentation(code, lineSet, linepad, header, heading, lang_kit.lang, copy, loader)

    return result
}

export const defaultOptions = {
    theme : 'ace-dark',
}

/* set options */
export const setOptions = (options) => {
    let head = document.head
    let link, style
    let theme = options.theme

    // add theme css file in head of dcoument
    if(theme){
        link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = 'chroma/themes/' + theme + '.css'
        head.appendChild(link)
    }
}

export const Chroma = {
    supportedLangugaes,
    pickLanguage,
    setOptions
}
        </div>
                    <div chroma="true" language="html">
&lt;!DOCTYPE html>
&lt;html lang="en">
&lt;head>
    &lt;meta charset="UTF-8">
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge">
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0">
    &lt;title>Chroma&lt;/title>
    &lt;style>
        .wrapper{
            display : flex;
            justify-content : center;
            align-items : flex-end;
        }
        .preprocessor, .start-tag-name, .close-tag-name{
            color: #FF9D00;
        }
        #constant{
            color: #FF628C;
        }
        .function:nth-child(odd){
            color: white;
        }
        div > span{
            background: blue;
        }
    &lt;/style>

    &lt;script>
        const showOutput = () => {
            let el = document.getElementById('editor')
            el.innerHTML = 'Welcome to chroma world.'
        }
    &lt;/script>

    &lt;style>
        .wrapper{
            display : flex;
            justify-content : center;
            align-items : flex-end;
        }
        .preprocessor, .start-tag-name, .close-tag-name{
            color: #FF9D00;
        }
        #constant{
            color: #FF628C;
        }
        .function:nth-child(odd){
            color: white;
        }
        div > span{
            background: blue;
        }
    &lt;/style>

&lt;/head>
&lt;body>
    &lt;!-- This is a comment -->
    Your Code is beautiful show it off.
    &lt;div chroma="true" language="html" preloader="true" copy="true" heading="HTML Code">
        Place your code here...
    &lt;/div>
    &lt;?php 
        echo 'Working';
    ?&gt;
&lt;/body>
&lt;/html>
                    </div >

                    <div chroma="true" language="c" copy="true" preloader="true">
#include &lt;iostream>
using namespace std;

void printArray(int arr[], int size){
    cout &lt;&lt; "Array : ";
    for(int i=0; i&lt;size; i++)
        cout &lt;&lt; arr[i] &lt;&lt; " ";
    cout &lt;&lt; endl;
}

void removeOccurrence(int arr[], int size){
    int bucket[size]; // max capacity of bucket is size
    int k = 1; // elements in bucket
    bucket[0] = arr[0];
    int control = 0;
    for(int i=1; i&lt; size; i++){
        control = 1;
        for(int j=0; j&lt;k; j++){
            if(arr[i] == bucket[j]){ // check element in bucket
                control = 0;
            }
        }
        if(control) // include in bucket
            bucket[k++] = arr[i];
    }
    
    printArray(bucket, k);
}


int main(){

    int arr[]={1,2,3,1,1,5,2,4,3,2,7,6,2,1,3,2,5,2,3,1};

    int size = sizeof(arr)/sizeof(arr[0]);
    
    
    removeOccurrence(arr, size);

    return 0;

}
                    </div>
    </div>
    
    <div chroma="true" language="css"  copy="true" preloader="true">
/* Beauify */

.comment{
    color: #0088FF;
    font-style: italic;
}
.string{
    color: #3AD900;
}
.keyword, .doc, .attribute{
    color: #FFEE80;
}
.preprocessor, .start-tag-name, .close-tag-name{
    color: #FF9D00;
}
#constant{
    color: #FF628C;
}
.function:nth-child(odd){
    color: white;
}
div > span{
    background: blue;
}
    </div>

    
    <div chroma="true" language="sql" preloader="true">
SELECT * FROM `products` WHERE pro_name = 'phone';

SELECT column_name(s)
FROM table_name
WHERE column_name BETWEEN value_1 AND value_2;

ALTER TABLE table_name 
ADD column_name datatype;

SELECT column_name,
  CASE
    WHEN condition THEN 'Result_1'
    WHEN condition THEN 'Result_2'
    ELSE 'Result_3'
  END
FROM table_name;

SELECT column_name, COUNT(*)
FROM table_name
GROUP BY column_name
HAVING COUNT(*) > value;
    </div>

    <script src="chroma/dist/chroma.js"></script>
</body>
</html>